{% extends 'base.html' %}

{% block head %}
  {{ super() }}
  <link rel="stylesheet" href="{{ url_for('static', filename='css/post-detail.css') }}">
{% endblock %}

{% block container %}
<div class="container-fluid post-container">
  <h1 id="title">{{ post.title }}</h1>
  <div id="post" class="row">
    <div class="col-sm-2">
      <!-- Author Info -->
      <!-- TODO: Should replace icon with profile picture -->
      <div class="author">
        <h1>
          <i class="fa-solid fa-circle-user"></i>
        </h1>
      </div>
    </div>
    <div class="col-sm-8">
      <div class="card">
        <div class="card-body">
          <div class="card-text">
            {{ post.body | safe }}
          </div>
        </div>
        <div class="card-footer">
          <p class="card-text text-end">
            <small class="text-body-secondary">
              <i class="fa-solid fa-eye"></i> {{ post.views }}<br>
              Created at {{ post.real_timestamp }} by {{ post.user.username }}<br>
              {% if post.last_edited %}
              (last edited at {{ post.real_last_edited }})
              {% endif %}
            </small>
          </p>
        </div>
      </div>
    </div>
    <div class="col-sm-2">
      <div class="action-panel">
        {% if current_user.id == post.user_id %}
        <a href="" data-action="edit" class="btn btn-primary" data-bs-toggle="tooltip" data-bs-title="Edit the post">
          <i class="fa-solid fa-pen-to-square"></i>
        </a>
        <a href="{{ url_for('post.edit', post_id=post.id) }}" data-action="save" data-bs-toggle="tooltip"
          data-bs-title="Save the edit" class="btn btn-primary d-none">
          <i class="fa-solid fa-circle-check"></i>
        </a>
        <a href="" data-action="abort" class="btn btn-secondary d-none" data-bs-toggle="tooltip"
          data-bs-title="Abort the edit">
          <i class="fa-solid fa-circle-xmark"></i>
        </a>
        <a href="{{ url_for('post.delete', post_id=post.id) }}" data-action="delete" data-bs-toggle="tooltip"
          data-bs-title="Delete the post" class="btn btn-danger">
          <i class="fa-solid fa-trash-can"></i>
        </a>
        {% endif %}
      </div>
    </div>
  </div>
  <div id="replybox" class="row">
    <div class="col-sm-2"></div>
    <div class="col-sm-8">
      {% if current_user.is_authenticated %}
      <div id="reply-editor" style="min-height: 150px;"></div>
      {% elif not current_user.is_authenticated %}
      <div class="form-control d-flex justify-content-center align-items-center"
        style="min-height: 150px; background-color: var(--bs-secondary-bg);">
        <div>
          <a href="{{ url_for('auth.signin') }}">Sign in</a> to reply
        </div>
      </div>
      {% endif %}
    </div>
    <div class="col-sm-2">
      <div class="action-panel">
        {% if current_user.is_authenticated %}
        <a href="{{ url_for('post.reply', post_id=post.id) }}" data-action="reply" class="btn btn-primary"
          data-bs-toggle="tooltip" data-bs-title="Send reply">
          <i class="fa-solid fa-paper-plane"></i>
        </a>
        {% endif %}
      </div>
    </div>
  </div>
  {% include 'post/replies.html' %}

  {% if current_user.is_authenticated %}
  <!-- Modal -->
  <div class="modal fade" id="replyModal" tabindex="-1" aria-labelledby="replyModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="replyModalLabel">Reply to ...</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div id="modal-editor" style="min-height: 200px;"></div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
            <i class="fa-solid fa-circle-xmark"></i>
            Close
          </button>
          <button id="send-reply" type="button" class="btn btn-primary">
            <i class="fa-solid fa-paper-plane"></i>
            Send
          </button>
        </div>
      </div>
    </div>
  </div>
  {% endif %}
</div>
{% endblock %}

{% block script %}
{{ super() }}
  <script type="module" src="{{ url_for('static', filename='js/post/main.js') }}"></script>
{% endblock %}